

@*<link rel="stylesheet" href="~/Content/css/staff-benefit-calculation.css" asp-append-version="true">
 
<div style="background: #f8d7da; padding: 10px; margin-bottom: 20px;">
    <h4>Debug Information:</h4>
    <p>RiceOil: @Model.RiceOil</p>
    <p>StaffBenefit: @(Model.StaffBenefit?.BenefitName ?? "NULL")</p>
    <p>ChangeAmount: @Model.ChangeAmount</p>
    <p>CustomBenefitAmount: @Model.CustomBenefitAmount</p>
</div>*@


@model AddMemberSystem.Models.TB_Staff

@using System.Globalization

@{
    // Parse base salary
    decimal baseSalary = 0;
    decimal.TryParse(Model.Salary, out baseSalary);

    // Calculate Rice & Oil benefit
    decimal riceOilAmount = 0;
    if (Model.RiceOil && Model.StaffBenefit != null)
    {
        if (Model.ChangeAmount && Model.CustomBenefitAmount.HasValue)
        {
            riceOilAmount = Model.CustomBenefitAmount.Value;
        }
        else if (!Model.ChangeAmount && decimal.TryParse(Model.StaffBenefit.Amount, out decimal amount))
        {
            riceOilAmount = amount;
        }
    }

    // Calculate Social Security benefit
    decimal socialSecurityAmount = Model.SocialSecurity && Model.TotalConAmt.HasValue 
        ? Model.TotalConAmt.Value 
        : 0;

    // Get total leave days from controller
    int totalExcessLeaveDays = ViewBag.TotalExcessLeaveDays ?? 0;
    
    // Calculate leave deduction
    decimal leaveDeduction = 0;
    if (baseSalary > 0 && totalExcessLeaveDays > 0)
    {
        decimal dailySalary = baseSalary / 30;
        leaveDeduction = dailySalary * totalExcessLeaveDays;
    }

    // Calculate totals
    decimal totalDeductions = riceOilAmount + socialSecurityAmount + leaveDeduction;
    decimal netSalary = baseSalary - totalDeductions;
}

<div class="salary-card card shadow-sm mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">Salary Calculation for @ViewBag.MonthName @ViewBag.SelectedYear</h5>
    </div>
    <div class="card-body">
        <!-- Base Salary -->
        <div class="row salary-row">
            <div class="col-md-6">
                <div class="form-group">
                    <label class="font-weight-bold">Base Salary:</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <p class="form-control-plaintext base-salary">
                        @baseSalary.ToString("#,##0.00") MMK
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Deductions Header -->
        <div class="row deduction-header">
            <div class="col-12">
                <h6 class="text-muted">Deductions:</h6>
            </div>
        </div>
        
        <!-- Rice/Oil Deduction -->
        @if (Model.RiceOil)
        {
            <div class="row deduction-row">
                <div class="col-md-6 offset-md-1">
                    <div class="form-group">
                        <label class="font-weight-bold">@(Model.StaffBenefit?.BenefitName ?? "Benefit"):</label>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-group">
                        <p class="form-control-plaintext deduction-amount">
                            - @riceOilAmount.ToString("#,##0.00") MMK
                        </p>
                    </div>
                </div>
            </div>
        }
        
        <!-- Social Security Deduction -->
        @if (Model.SocialSecurity)
        {
            <div class="row deduction-row">
                <div class="col-md-6 offset-md-1">
                    <div class="form-group">
                        <label class="font-weight-bold">Social Security:</label>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-group">
                        <p class="form-control-plaintext deduction-amount">
                            - @socialSecurityAmount.ToString("#,##0.00") MMK
                        </p>
                    </div>
                </div>
            </div>
        }
        
        <!-- Leave Deduction -->
        @if (totalExcessLeaveDays > 0)
        {
            <div class="row deduction-row">
                <div class="col-md-6 offset-md-1">
                    <div class="form-group">
                        <label class="font-weight-bold">Excess Leave:</label>
                        <p class="text-muted small mb-0">
                            (@totalExcessLeaveDays days × @((baseSalary / 30).ToString("#,##0.00")) MMK/day)
                        </p>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="form-group">
                        <p class="form-control-plaintext deduction-amount">
                            - @leaveDeduction.ToString("#,##0.00") MMK
                        </p>
                    </div>
                </div>
            </div>
        }
        
        <!-- Total Deductions -->
        <div class="row total-deduction-row">
            <div class="col-md-6">
                <div class="form-group">
                    <label class="font-weight-bold">Total Deductions:</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <p class="form-control-plaintext total-deduction">
                        - @totalDeductions.ToString("#,##0.00") MMK
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Net Salary -->
        <div class="row net-salary-row">
            <div class="col-md-6">
                <div class="form-group">
                    <label class="font-weight-bold">Net Salary:</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <p class="form-control-plaintext net-salary">
                        @netSalary.ToString("#,##0.00") MMK
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .salary-card {
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid #ddd;
    }
    
    .card-header {
        border-top-left-radius: 10px !important;
        border-top-right-radius: 10px !important;
        padding: 15px 20px;
    }
    
    .salary-row, .deduction-row, .total-deduction-row, .net-salary-row {
        margin-bottom: 10px;
        padding: 5px 20px;
    }
    
    .deduction-header {
        margin-top: 20px;
        margin-bottom: 10px;
        margin-left:10px;
        padding: 5px 20px;
        border-bottom: 1px dashed #ddd;
    }
    
    .base-salary {
        color: #2c3e50;
        font-size: 18px;
        font-weight: 600;
        padding: 8px 15px;
        background-color: #e3f2fd;
        border-radius: 5px;
    }
    
    .deduction-amount {
        color: #e74c3c;
        font-size: 16px;
        font-weight: 500;
        padding: 6px 12px;
    }
    
    .total-deduction {
        color: #c0392b;
        font-size: 17px;
        font-weight: 600;
        padding: 8px 15px;
        background-color: #ffebee;
        border-radius: 5px;
    }
    
    .net-salary {
        color: #27ae60;
        font-size: 20px;
        font-weight: 700;
        padding: 10px 15px;
        background-color: #e8f5e9;
        border-radius: 5px;
    }
    
    .deduction-row {
        font-size: 15px;
    }
    
    .text-muted.small {
        font-size: 13px;
    }
</style>





