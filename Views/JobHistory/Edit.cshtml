@model AddMemberSystem.Models.TB_JobHistory

@{
    ViewData["Title"] = "Edit";
}

<link rel="stylesheet" href="~/css/general.css">

<div class="row header-container">
    <div class="col-md-10">
        <h1>အလုပ်သမိုင်း မှတ်တမ်း ပြန်လည်ပြုပြင်ခြင်း</h1>
    </div>
</div>

<form asp-action="Edit" method="post">
    <div class="row">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="JobHistoryPkid" />
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="StaffID" class="control-label"><span style="font-weight: 600;">ဝန်ထမ်းအမှတ်</span> </label>
            <input asp-for="StaffID" class="form-control" />
            <span asp-validation-for="StaffID" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="Department" class="control-label">ဌာန</label>
            <select asp-for="DepartmentId" class="form-control" asp-items="ViewBag.DepartmentId"></select>
            <span asp-validation-for="Department" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="Position" class="control-label">ရာထူး</label>
            <select asp-for="PositionId" class="form-control" asp-items="ViewBag.PositionId"></select>
            <span asp-validation-for="Position" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-12">
            <div class="form-check">
                <input asp-for="IsCurrent" class="form-check-input" type="checkbox" />
                <label asp-for="IsCurrent" class="form-check-label"><span style="font-weight: 600;">ယခု အလုပ်လုပ်နေသည့်ရာထူးဖြစ်သည်</span></label>
                <span asp-validation-for="IsCurrent" class="text-danger"></span>
            </div>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="FromDate" class="control-label"></label>
            <input asp-for="FromDate" id="FromDate" class="form-control" type="date" />
            <span asp-validation-for="FromDate" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="ToDate" class="control-label"></label>
            <input asp-for="ToDate" id="ToDate" class="form-control" type="date" />
            <span asp-validation-for="ToDate" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="JobYear" class="control-label"><span style="font-weight:600;">အလုပ်နှစ်</span></label>
            <input asp-for="JobYear" class="form-control" readonly />
            <span asp-validation-for="JobYear" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="JobMonth" class="control-label"><span style="font-weight:600;">အလုပ်လ</span></label>
            <input asp-for="JobMonth" class="form-control" readonly />
            <span asp-validation-for="JobMonth" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="JobDay" class="control-label"><span style="font-weight:600;">အလုပ်ရက်</span></label>
            <input asp-for="JobDay" class="form-control" readonly />
            <span asp-validation-for="JobDay" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="Duration" class="control-label"><span style="font-weight:600;">အလုပ်သက်တမ်း</span></label>
            <input asp-for="Duration" class="form-control" readonly />
            <span asp-validation-for="Duration" class="text-danger"></span>
        </div>
        <div class="form-group col-sm-12 col-md-12 col-lg-4">
            <label asp-for="Remark" class="control-label"><span style="font-weight: 600;">မှတ်ချက်</span> </label>
            <input asp-for="Remark" class="form-control" />
            <span asp-validation-for="Remark" class="text-danger"></span>
        </div>
       
        <div class="form-group col-sm-12 col-md-12 col-lg-12">
            <input type="submit" value="ပြုပြင်မည်" class="btn btn-primary col-md-2" />
        </div>
    </div>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const isCurrent = document.getElementById('IsCurrent');
            const toDateInput = document.getElementById('ToDate');
            const fromDateInput = document.getElementById('FromDate');
            const durationInput = document.getElementById('Duration');
            const jobYearInput = document.getElementById('JobYear');
            const jobMonthInput = document.getElementById('JobMonth');
            const jobDayInput = document.getElementById('JobDay');

            // Initialize on load
            toggleToDateState();

            // Event listeners
            isCurrent.addEventListener('change', toggleToDateState);
            fromDateInput.addEventListener('change', calculateDuration);
            toDateInput.addEventListener('change', calculateDuration);

            function toggleToDateState() {
                if (isCurrent.checked) {
                    toDateInput.disabled = true;
                    toDateInput.value = '';
                } else {
                    toDateInput.disabled = false;
                }
                calculateDuration();
            }

            function calculateDuration() {
                if (!fromDateInput.value) return;

                const fromDate = new Date(fromDateInput.value);
                const toDate = isCurrent.checked ? new Date() : new Date(toDateInput.value);

                if (isNaN(toDate) || toDate < fromDate) return;

                // Calculate duration
                let years = toDate.getFullYear() - fromDate.getFullYear();
                let months = toDate.getMonth() - fromDate.getMonth();
                let days = toDate.getDate() - fromDate.getDate();

                if (days < 0) {
                    months--;
                    days += new Date(toDate.getFullYear(), toDate.getMonth(), 0).getDate();
                }
                if (months < 0) {
                    years--;
                    months += 12;
                }

                // Update fields
                jobYearInput.value = years;
                jobMonthInput.value = months;
                jobDayInput.value = days;
                durationInput.value = `${years} years, ${months} months, ${days} days`;
            }
        });
    </script>
}